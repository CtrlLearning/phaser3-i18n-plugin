{"version":3,"file":"I18nPlugin.js","sourceRoot":"","sources":["../../../../src/com/koreez/plugin/I18nPlugin.ts"],"names":[],"mappings":";;;AAAA,mCAA8B;AAC9B,yCAA2C;AAE3C,wDAAmD;AAEnD;IAAgC,sCAA0B;IAA1D;;IAyRA,CAAC;IAxRiB,4BAAiB,GAA/B;QACI,wBAAc,CAAC,UAAU,EAAE,CAAC;QAE5B,wBAAc,CAAC,gBAAgB,EAAE,CAAC;QAElC,wBAAc,CAAC,uBAAuB,EAAE,CAAC;IAC7C,CAAC;IAED,sBAAW,+BAAO;aAAlB;YACI,OAAO,iBAAO,CAAC,OAAO,CAAC;QAC3B,CAAC;;;OAAA;IAED,sBAAW,gCAAQ;aAAnB;YACI,OAAO,iBAAO,CAAC,QAAQ,CAAC;QAC5B,CAAC;;;OAAA;IAMM,yBAAI,GAAX;QACI,IAAM,YAAY,GAA+B,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;QAKrE,YAAY,CAAC,EAAE,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;QACjD,YAAY,CAAC,EAAE,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;QACjD,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5D,IAAI,CAAC,EAAE,CAAC,iBAAiB,EAAE,IAAI,CAAC,oBAAoB,CAAC,CAAC;IAC1D,CAAC;IAMM,+BAAU,GAAjB,UAAkB,OAAY,EAAE,QAA2B;QACvD,iBAAO,CAAC,GAAG,CAAC,IAAI,GAAG,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,CAAC;QACpC,IAAI,OAAO,EAAE;YACT,iBAAO,CAAC,IAAI,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;YAChC,OAAO;SACV;QACD,iBAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC3B,CAAC;IAMM,wBAAG,GAAV,UAAW,MAAW;QAClB,OAAO,iBAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;IAC/B,CAAC;IAEM,sBAAC,GAAR,UAIE,GAAoB,EAAE,OAAmC;QACvD,OAAO,iBAAO,CAAC,CAAC,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;IACnC,CAAC;IAEM,2BAAM,GAAb,UAAc,GAAsB,EAAE,OAAsC;QACxE,OAAO,iBAAO,CAAC,MAAM,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;IACxC,CAAC;IAEM,kCAAa,GAApB,UAAqB,QAA6B;QAC9C,iBAAO,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;IACpC,CAAC;IAEM,mCAAc,GAArB,UAAsB,OAA6B,EAAE,QAA2B;QAC5E,OAAO,iBAAO,CAAC,cAAc,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;IACrD,CAAC;IAEM,kCAAa,GAApB,UAAqB,OAA6B,EAAE,QAA2B;QAC3E,OAAO,iBAAO,CAAC,aAAa,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;IACpD,CAAC;IAOM,8BAAS,GAAhB,UAAiB,GAAsB,EAAE,EAAsB;QAC3D,OAAO,iBAAO,CAAC,SAAS,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;IACtC,CAAC;IAMM,mCAAc,GAArB,UAAsB,GAAW,EAAE,QAA2B;QAC1D,OAAO,iBAAO,CAAC,cAAc,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;IACjD,CAAC;IAMD,sBAAW,gCAAQ;aAAnB;YACI,OAAO,iBAAO,CAAC,QAAQ,CAAC;QAC5B,CAAC;;;OAAA;IAKD,sBAAW,iCAAS;aAApB;YACI,OAAO,iBAAO,CAAC,SAAS,CAAC;QAC7B,CAAC;;;OAAA;IAKM,mCAAc,GAArB,UAAsB,EAAqB,EAAE,QAA0B;QACnE,OAAO,iBAAO,CAAC,cAAc,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;IAChD,CAAC;IAKM,kCAAa,GAApB,UAAqB,IAAuB,EAAE,QAA0B;QACpE,OAAO,iBAAO,CAAC,aAAa,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;IACjD,CAAC;IAKM,oCAAe,GAAtB,UAAuB,IAAe,EAAE,EAAa;QACjD,OAAO,iBAAO,CAAC,eAAe,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;IAC7C,CAAC;IAKM,wCAAmB,GAA1B,UAA2B,EAAU;QACjC,iBAAO,CAAC,mBAAmB,CAAC,EAAE,CAAC,CAAC;IACpC,CAAC;IAKM,wBAAG,GAAV,UAAW,GAAY;QACnB,OAAO,iBAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IAC5B,CAAC;IAKD,sBAAW,8BAAM;aAAjB;YACI,OAAO,iBAAO,CAAC,MAAM,CAAC;QAC1B,CAAC;;;OAAA;IAKM,uBAAE,GAAT,UAAU,KAAa,EAAE,QAAkC;QACvD,iBAAO,CAAC,EAAE,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;IAChC,CAAC;IAKM,wBAAG,GAAV,UAAW,KAAa,EAAE,QAAkC;QACxD,iBAAO,CAAC,GAAG,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;IACjC,CAAC;IAKM,gCAAW,GAAlB,UACI,GAAW,EACX,EAAU,EACV,GAAW,EACX,OAEC;QAED,iBAAO,CAAC,WAAW,CAAC,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,OAAO,CAAC,CAAC;IAC/C,CAAC;IAKM,gCAAW,GAAlB,UACI,GAAW,EACX,EAAU,EACV,GAAW,EACX,KAAa,EACb,OAGC;QAED,iBAAO,CAAC,WAAW,CAAC,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,OAAO,CAAC,CAAC;IACtD,CAAC;IAKM,iCAAY,GAAnB,UAAoB,GAAW,EAAE,EAAU,EAAE,SAAc;QACvD,iBAAO,CAAC,YAAY,CAAC,GAAG,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC;IAC7C,CAAC;IAOM,sCAAiB,GAAxB,UAAyB,GAAW,EAAE,EAAU,EAAE,SAAc,EAAE,IAAc,EAAE,SAAmB;QACjG,iBAAO,CAAC,iBAAiB,CAAC,GAAG,EAAE,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,SAAS,CAAC,CAAC;IACnE,CAAC;IAKM,sCAAiB,GAAxB,UAAyB,GAAW,EAAE,EAAU;QAC5C,OAAO,iBAAO,CAAC,iBAAiB,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;IAC9C,CAAC;IAKM,sCAAiB,GAAxB,UAAyB,GAAW,EAAE,EAAU;QAC5C,OAAO,iBAAO,CAAC,iBAAiB,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;IAC9C,CAAC;IAKM,yCAAoB,GAA3B,UAA4B,GAAW,EAAE,EAAU;QAC/C,iBAAO,CAAC,oBAAoB,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;IAC1C,CAAC;IAKD,sBAAW,+BAAO;aAAlB;YACI,OAAO,iBAAO,CAAC,OAAO,CAAC;QAC3B,CAAC;;;OAAA;IAKD,sBAAW,qCAAa;aAAxB;YACI,OAAO,iBAAO,CAAC,aAAa,CAAC;QACjC,CAAC;;;OAAA;IAEM,wCAAmB,GAA1B,UAA2B,GAAQ;QAAnC,iBAqBC;QApBG,IACI,GAAG,YAAY,MAAM,CAAC,WAAW,CAAC,IAAI;YACtC,GAAG,YAAY,MAAM,CAAC,WAAW,CAAC,UAAU;YAC5C,GAAG,YAAY,MAAM,CAAC,WAAW,CAAC,iBAAiB,EACrD;YACG,GAAW,CAAC,OAAO,CAAE,GAAW,CAAC,QAAQ,CAAC,CAAC;YAC5C,OAAO;SACV;QACD,IAAI,GAAG,YAAY,MAAM,CAAC,WAAW,CAAC,SAAS,EAAE;YAC7C,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,UAAC,KAAU;gBACxB,KAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;YACpC,CAAC,CAAC,CAAC;YACH,OAAO;SACV;QAED,IAAI,GAAG,CAAC,QAAQ,IAAI,GAAG,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;YACzC,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAC,KAAU;gBACzB,KAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;YACpC,CAAC,CAAC,CAAC;SACN;IACL,CAAC;IAEO,6BAAQ,GAAhB;QACI,IAAI,CAAC,GAAG,CAAC,iBAAiB,EAAE,IAAI,CAAC,oBAAoB,CAAC,CAAC;QACvD,IAAM,YAAY,GAA+B,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;QACrE,YAAY,CAAC,GAAG,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;QACzD,YAAY,CAAC,GAAG,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;QACzD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;IACtB,CAAC;IAEO,oCAAe,GAAvB;QACI,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACzC,CAAC;IACL,iBAAC;AAAD,CAAC,AAzRD,CAAgC,MAAM,CAAC,OAAO,CAAC,WAAW,GAyRzD;AAzRY,gCAAU;AA2RvB,UAAU,CAAC,iBAAiB,EAAE,CAAC","sourcesContent":["import i18next from \"i18next\";\r\nimport * as XHR from \"i18next-xhr-backend\";\r\nimport { Ii18n } from \"./i18n/Ii18n\";\r\nimport textExtensions from \"./i18n/textExtensions\";\r\n\r\nexport class I18nPlugin extends Phaser.Plugins.ScenePlugin implements Ii18n {\r\n    public static staticConstructor(): any {\r\n        textExtensions.extendText();\r\n\r\n        textExtensions.extendBitmapText();\r\n\r\n        textExtensions.extendDynamicBitmapText();\r\n    }\r\n\r\n    public get modules(): i18next.Modules {\r\n        return i18next.modules;\r\n    }\r\n\r\n    public get services(): i18next.Services {\r\n        return i18next.services;\r\n    }\r\n\r\n    private languageChangedBound: any;\r\n\r\n    //  Called when the Plugin is booted by the PluginManager.\r\n    //  If you need to reference other systems in the Scene (like the Loader or DisplayList) then set-up those references now, not in the constructor.\r\n    public boot(): void {\r\n        const eventEmitter: Phaser.Events.EventEmitter = this.systems.events;\r\n\r\n        //  Listening to the following events is entirely optional, although we would recommend cleanly shutting down and destroying at least.\r\n        //  If you don't need any of these events then remove the listeners and the relevant methods too.\r\n\r\n        eventEmitter.on(\"shutdown\", this.shutdown, this);\r\n        eventEmitter.on(\"shutdown\", this.shutdown, this);\r\n        this.languageChangedBound = this.languageChanged.bind(this);\r\n        this.on(\"languageChanged\", this.languageChangedBound);\r\n    }\r\n\r\n    /**\r\n     * @param options - Initial options.\r\n     * @param callback - will be called after all translations were loaded or with an error when failed (in case of using a backend).\r\n     */\r\n    public initialize(options: any, callback?: i18next.Callback): void {\r\n        i18next.use(new XHR(null, options));\r\n        if (options) {\r\n            i18next.init(options, callback);\r\n            return;\r\n        }\r\n        i18next.init(callback);\r\n    }\r\n\r\n    /**\r\n     * The use function is there to load additional plugins to i18next.\r\n     * For available module see the plugins page and don't forget to read the documentation of the plugin.\r\n     */\r\n    public use(module: any): i18next.i18n {\r\n        return i18next.use(module);\r\n    }\r\n\r\n    public t<\r\n        TResult extends string | object | Array<string | object> | undefined = string,\r\n        TKeys extends string = string,\r\n        TValues extends object = object\r\n    >(key: TKeys | TKeys[], options?: i18next.TOptions<TValues>): TResult {\r\n        return i18next.t(key, options);\r\n    }\r\n\r\n    public exists(key: string | string[], options?: i18next.InterpolationOptions): boolean {\r\n        return i18next.exists(key, options);\r\n    }\r\n\r\n    public loadResources(callback?: (err: any) => void): void {\r\n        i18next.loadResources(callback);\r\n    }\r\n\r\n    public createInstance(options?: i18next.InitOptions, callback?: i18next.Callback): i18next.i18n {\r\n        return i18next.createInstance(options, callback);\r\n    }\r\n\r\n    public cloneInstance(options?: i18next.InitOptions, callback?: i18next.Callback): i18next.i18n {\r\n        return i18next.cloneInstance(options, callback);\r\n    }\r\n\r\n    /**\r\n     * Returns a t function that defaults to given language or namespace.\r\n     * Both params could be arrays of languages or namespaces and will be treated as fallbacks in that case.\r\n     * On the returned function you can like in the t function override the languages or namespaces by passing them in options or by prepending namespace.\r\n     */\r\n    public getFixedT(lng: string | string[], ns?: string | string[]): i18next.TFunction {\r\n        return i18next.getFixedT(lng, ns);\r\n    }\r\n\r\n    /**\r\n     * Changes the language. The callback will be called as soon translations were loaded or an error occurs while loading.\r\n     * HINT: For easy testing - setting lng to 'cimode' will set t function to always return the key.\r\n     */\r\n    public changeLanguage(lng: string, callback?: i18next.Callback): Promise<i18next.TFunction> {\r\n        return i18next.changeLanguage(lng, callback);\r\n    }\r\n\r\n    /**\r\n     * Is set to the current detected or set language.\r\n     * If you need the primary used language depending on your configuration (whilelist, load) you will prefer using i18next.languages[0].\r\n     */\r\n    public get language(): string {\r\n        return i18next.language;\r\n    }\r\n\r\n    /**\r\n     * Is set to an array of language-codes that will be used it order to lookup the translation value.\r\n     */\r\n    public get languages(): string[] {\r\n        return i18next.languages;\r\n    }\r\n\r\n    /**\r\n     * Loads additional namespaces not defined in init options.\r\n     */\r\n    public loadNamespaces(ns: string | string[], callback: i18next.Callback): Promise<void> {\r\n        return i18next.loadNamespaces(ns, callback);\r\n    }\r\n\r\n    /**\r\n     * Loads additional languages not defined in init options (preload).\r\n     */\r\n    public loadLanguages(lngs: string | string[], callback: i18next.Callback): Promise<void> {\r\n        return i18next.loadLanguages(lngs, callback);\r\n    }\r\n\r\n    /**\r\n     * Reloads resources on given state. Optionally you can pass an array of languages and namespaces as params if you don't want to reload all.\r\n     */\r\n    public reloadResources(lngs?: string[], ns?: string[]): Promise<void> {\r\n        return i18next.reloadResources(lngs, ns);\r\n    }\r\n\r\n    /**\r\n     * Changes the default namespace.\r\n     */\r\n    public setDefaultNamespace(ns: string): void {\r\n        i18next.setDefaultNamespace(ns);\r\n    }\r\n\r\n    /**\r\n     * Returns rtl or ltr depending on languages read direction.\r\n     */\r\n    public dir(lng?: string): \"ltr\" | \"rtl\" {\r\n        return i18next.dir(lng);\r\n    }\r\n\r\n    /**\r\n     * Exposes interpolation.format function added on init.\r\n     */\r\n    public get format(): i18next.FormatFunction {\r\n        return i18next.format;\r\n    }\r\n\r\n    /**\r\n     * Event listener\r\n     */\r\n    public on(event: string, listener: (...args: any[]) => void): void {\r\n        i18next.on(event, listener);\r\n    }\r\n\r\n    /**\r\n     * Remove event listener\r\n     */\r\n    public off(event: string, listener: (...args: any[]) => void): void {\r\n        i18next.off(event, listener);\r\n    }\r\n\r\n    /**\r\n     * Gets one value by given key.\r\n     */\r\n    public getResource(\r\n        lng: string,\r\n        ns: string,\r\n        key: string,\r\n        options?: {\r\n            keySeparator?: string;\r\n        }\r\n    ): any {\r\n        i18next.getResource(lng, ns, key, options);\r\n    }\r\n\r\n    /**\r\n     * Adds one key/value.\r\n     */\r\n    public addResource(\r\n        lng: string,\r\n        ns: string,\r\n        key: string,\r\n        value: string,\r\n        options?: {\r\n            keySeparator?: string;\r\n            silent?: boolean;\r\n        }\r\n    ): void {\r\n        i18next.addResource(lng, ns, key, value, options);\r\n    }\r\n\r\n    /**\r\n     * Adds multiple key/values.\r\n     */\r\n    public addResources(lng: string, ns: string, resources: any): void {\r\n        i18next.addResources(lng, ns, resources);\r\n    }\r\n\r\n    /**\r\n     * Adds a complete bundle.\r\n     * Setting deep param to true will extend existing translations in that file.\r\n     * Setting overwrite to true it will overwrite existing translations in that file.\r\n     */\r\n    public addResourceBundle(lng: string, ns: string, resources: any, deep?: boolean, overwrite?: boolean): void {\r\n        i18next.addResourceBundle(lng, ns, resources, deep, overwrite);\r\n    }\r\n\r\n    /**\r\n     * Checks if a resource bundle exists.\r\n     */\r\n    public hasResourceBundle(lng: string, ns: string): boolean {\r\n        return i18next.hasResourceBundle(lng, ns);\r\n    }\r\n\r\n    /**\r\n     * Returns a resource bundle.\r\n     */\r\n    public getResourceBundle(lng: string, ns: string): any {\r\n        return i18next.getResourceBundle(lng, ns);\r\n    }\r\n\r\n    /**\r\n     * Removes an existing bundle.\r\n     */\r\n    public removeResourceBundle(lng: string, ns: string): void {\r\n        i18next.removeResourceBundle(lng, ns);\r\n    }\r\n\r\n    /**\r\n     * Current options\r\n     */\r\n    public get options(): i18next.InitOptions {\r\n        return i18next.options;\r\n    }\r\n\r\n    /**\r\n     * Is initialized\r\n     */\r\n    public get isInitialized(): boolean {\r\n        return i18next.isInitialized;\r\n    }\r\n\r\n    public recursiveUpdateText(obj: any): void {\r\n        if (\r\n            obj instanceof Phaser.GameObjects.Text ||\r\n            obj instanceof Phaser.GameObjects.BitmapText ||\r\n            obj instanceof Phaser.GameObjects.DynamicBitmapText\r\n        ) {\r\n            (obj as any).setText((obj as any)._i18nKey);\r\n            return;\r\n        }\r\n        if (obj instanceof Phaser.GameObjects.Container) {\r\n            obj.list.forEach((child: any) => {\r\n                this.recursiveUpdateText(child);\r\n            });\r\n            return;\r\n        }\r\n\r\n        if (obj.children && obj.children.length > 0) {\r\n            obj.children.each((child: any) => {\r\n                this.recursiveUpdateText(child);\r\n            });\r\n        }\r\n    }\r\n\r\n    private shutdown(): void {\r\n        this.off(\"languageChanged\", this.languageChangedBound);\r\n        const eventEmitter: Phaser.Events.EventEmitter = this.systems.events;\r\n        eventEmitter.off(\"shutdown\", this.shutdown, this, false);\r\n        eventEmitter.off(\"shutdown\", this.shutdown, this, false);\r\n        this.scene = null;\r\n    }\r\n\r\n    private languageChanged(): void {\r\n        this.recursiveUpdateText(this.scene);\r\n    }\r\n}\r\n\r\nI18nPlugin.staticConstructor();\r\n"]}